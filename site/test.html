<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Data Loading</title>
    <script src="assets/js/storage.js"></script>
    <script src="assets/js/data.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js" onerror="loadChartJsFallback()"></script>
</head>
<body>
    <h1>Test Data Loading</h1>
    <div id="dataInfo"></div>
    <canvas id="testChart" width="400" height="200"></canvas>
    
    <script>
        function loadChartJsFallback() {
            console.log('Trying fallback Chart.js CDN...');
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js';
            script.onerror = function() {
                console.error('Chart.js failed to load from both CDNs');
                document.getElementById('dataInfo').innerHTML += '<p style="color: red;">Chart.js không tải được từ cả hai CDN</p>';
            };
            document.head.appendChild(script);
        }
        
        console.log('Bắt đầu test...');
        
        // Force seed data
        seedDemoData(true);
        
        // Check data
        const products = storage.get('products', []);
        const transactions = storage.get('transactions', []);
        const warehouses = storage.get('warehouses', []);
        
        console.log('Data loaded:', {
            products: products.length,
            transactions: transactions.length,
            warehouses: warehouses.length
        });
        
        document.getElementById('dataInfo').innerHTML = `
            <p>Sản phẩm: ${products.length}</p>
            <p>Giao dịch: ${transactions.length}</p>
            <p>Kho: ${warehouses.length}</p>
        `;
        
        // Test Chart.js
        if (typeof Chart !== 'undefined') {
            console.log('Chart.js loaded successfully');
            new Chart(document.getElementById('testChart'), {
                type: 'bar',
                data: {
                    labels: warehouses.map(w => w.code),
                    datasets: [{
                        label: 'Diện tích còn trống',
                        data: warehouses.map(w => w.areaFree || 0),
                        backgroundColor: '#22c55e'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Test Chart'
                        }
                    }
                }
            });
            console.log('Test chart created successfully');
        } else {
            console.error('Chart.js not loaded');
            document.getElementById('dataInfo').innerHTML += '<p style="color: red;">Chart.js không tải được</p>';
        }
    </script>
</body>
</html>
